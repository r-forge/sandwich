<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Clustered Covariance Matrix Estimation — vcovCL • sandwich</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Clustered Covariance Matrix Estimation — vcovCL"><meta property="og:description" content="Estimation of one-way and multi-way clustered
  covariance matrices using an object-oriented approach."><meta property="og:image" content="https://sandwich.R-Forge.R-project.org/logo.png"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@AchimZeileis"><meta name="twitter:site" content="@AchimZeileis"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sandwich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.1-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/sandwich.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/jss_2004.html">Econometric Computing with HC and HAC Covariance Matrix Estimators</a>
    </li>
    <li>
      <a href="../articles/jss_2006.html">Object-Oriented Computation of Sandwich Estimators</a>
    </li>
    <li>
      <a href="../articles/jss_2020.html">Various Versatile Variances: An Object-Oriented Implementation of Clustered Covariances in R</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../contact.html">Contact</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Clustered Covariance Matrix Estimation</h1>
    
    <div class="hidden name"><code>vcovCL.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimation of one-way and multi-way clustered
  covariance matrices using an object-oriented approach.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">vcovCL</span><span class="op">(</span><span class="va">x</span>, cluster <span class="op">=</span> <span class="cn">NULL</span>, type <span class="op">=</span> <span class="cn">NULL</span>, sandwich <span class="op">=</span> <span class="cn">TRUE</span>, fix <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span>
<span class="fu">meatCL</span><span class="op">(</span><span class="va">x</span>, cluster <span class="op">=</span> <span class="cn">NULL</span>, type <span class="op">=</span> <span class="cn">NULL</span>, cadjust <span class="op">=</span> <span class="cn">TRUE</span>, multi0 <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a fitted model object.</p></dd>
<dt>cluster</dt>
<dd><p>a variable indicating the clustering of observations,
    a <code>list</code> (or <code>data.frame</code>) thereof, or a formula specifying
    which variables from the fitted model should be used (see examples).
    By default (<code>cluster = NULL</code>), either <code>attr(x, "cluster")</code> is used
    (if any) or otherwise every observation is assumed to be its own cluster.</p></dd>
<dt>type</dt>
<dd><p>a character string specifying the estimation type (HC0--HC3). 
    The default is to use <code>"HC1"</code> for <code>lm</code> objects and
    <code>"HC0"</code> otherwise.</p></dd>
<dt>sandwich</dt>
<dd><p>logical. Should the sandwich estimator be computed?
    If set to <code>FALSE</code> only the meat matrix is returned.</p></dd>
<dt>fix</dt>
<dd><p>logical. Should the covariance matrix be fixed to be
    positive semi-definite in case it is not?</p></dd>
<dt>cadjust</dt>
<dd><p>logical. Should a cluster adjustment be applied?</p></dd>
<dt>multi0</dt>
<dd><p>logical. Should the HC0 estimate be used for
    the final adjustment in multi-way clustered covariances?</p></dd>
<dt>...</dt>
<dd><p>arguments passed to <code>meatCL</code>.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Clustered sandwich estimators are used to adjust inference when errors
  are correlated within (but not between) clusters. <code>vcovCL</code> allows
  for clustering in arbitrary many cluster dimensions (e.g., firm, time, industry), given all
  dimensions have enough clusters (for more details, see Cameron et al. 2011).
  If each observation is its own cluster, the clustered sandwich
  collapses to the basic sandwich covariance.</p>  
<p>The function <code>meatCL</code> is the work horse for estimating
  the meat of clustered sandwich estimators. <code>vcovCL</code> is a wrapper calling
  <code><a href="sandwich.html">sandwich</a></code> and <code><a href="bread.html">bread</a></code> (Zeileis 2006).
  <code>vcovCL</code> is applicable beyond <code>lm</code> or <code>glm</code> class objects.</p>
<p><code><a href="bread.html">bread</a></code> and <code><a href="meat.html">meat</a></code> matrices are multiplied to
  construct clustered sandwich estimators.
  The meat of a clustered sandwich estimator is the cross product of
  the clusterwise summed estimating functions. Instead of summing over
  all individuals, first sum over cluster.</p> 
<p>A two-way clustered sandwich estimator \(M\) (e.g., for cluster dimensions
  "firm" and "industry" or "id" and "time") is a linear combination of
  one-way clustered sandwich estimators for both dimensions
  (\(M_{id}, M_{time}\)) minus the
  clustered sandwich estimator, with clusters formed out of the
  intersection of both dimensions (\(M_{id \cap time}\)):
  $$M = M_{id} + M_{time} - M_{id \cap time}$$.
  Additionally, each of the three terms can be weighted by the corresponding
  cluster bias adjustment factor (see below and Equation 20 in Zeileis et al. 2020).
  Instead of subtracting \(M_{id \cap time}\) as the last
  subtracted matrix, Ma (2014) suggests to subtract the basic HC0
  covariance matrix when only a single observation is in each
  intersection of \(id\)  and \(time\).
  Set <code>multi0 = TRUE</code> to subtract the basic HC0 covariance matrix as
  the last subtracted matrix in multi-way clustering. For details,
  see also Petersen (2009) and Thompson (2011).</p>  
<p>With the <code>type</code> argument, HC0 to HC3 types of
  bias adjustment can be employed, following the terminology used by
  MacKinnon and White (1985) for heteroscedasticity corrections. HC0 applies no small sample bias adjustment.
  HC1 applies a degrees of freedom-based correction, \((n-1)/(n-k)\) where \(n\) is the
  number of observations and \(k\) is the number of explanatory or predictor variables in the model.
  HC1 is the most commonly used approach for linear models, and HC0 otherwise. Hence these
  are the defaults in <code>vcovCL</code>. However, HC0 and HC1 are less effective
  than HC2 and HC3 when the number of clusters is relatively small (Cameron et al. 2008).
  HC2 and HC3 types of bias adjustment are geared towards the linear
  model, but they are also applicable for GLMs (see Bell and McCaffrey
  2002, and Kauermann and Carroll 2001, for details).
  A precondition for HC2 and HC3 types of bias adjustment is the availability
  of a hat matrix (or a weighted version therof for GLMs) and hence
  these two types are currently only implemented for <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>
  and <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code> objects.</p>  
<p>An alternative to the clustered HC3 estimator is the clustered jackknife estimator
  which is available in <code><a href="vcovBS.html">vcovBS</a></code> with <code>type = "jackknife"</code>. In linear
  models the HC3 and the jackknife estimator coincide (MacKinnon et al. 2022) with the
  latter still being computationally feasible if the number of observations per cluster
  is large. In nonlinear models (including non-Gaussian GLMs) the jackknife and the HC3
  estimator do not coincide but the jackknife might still be a useful alternative when
  the HC3 cannot be computed.</p>  
<p>The <code>cadjust</code> argument allows to
  switch the cluster bias adjustment factor \(G/(G-1)\) on and
  off (where \(G\) is the number of clusters in a cluster dimension \(g\))
  See Cameron et al. (2008) and Cameron et al. (2011) for more details about
  small-sample modifications.</p>
<p>The <code>cluster</code> specification can be made in a number of ways: The <code>cluster</code>
  can be a single variable or a <code>list</code>/<code>data.frame</code> of multiple
  clustering variables. If <code><a href="https://rdrr.io/r/stats/expand.model.frame.html" class="external-link">expand.model.frame</a></code> works
  for the model object <code>x</code>, the <code>cluster</code> can also be a <code>formula</code>.
  By default (<code>cluster = NULL</code>), <code>attr(x, "cluster")</code> is checked and
  used if available. If not, every observation is assumed to be its own cluster.
  If the number of observations in the model <code>x</code> is smaller than in the
  original <code>data</code> due to <code>NA</code> processing, then the same <code>NA</code> processing
  can be applied to <code>cluster</code> if necessary (and <code>x$na.action</code> being
  available).</p>
<p>Cameron et al. (2011) observe that sometimes the covariance matrix is
  not positive-semidefinite and recommend to employ the eigendecomposition of the estimated
  covariance matrix, setting any negative eigenvalue(s) to zero. This fix
  is applied, if necessary, when <code>fix = TRUE</code> is specified.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A matrix containing the covariance matrix estimate.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Bell RM, McCaffrey DF (2002).
  “Bias Reduction in Standard Errors for Linear Regression with Multi-Stage Samples”,
  <em>Survey Methodology</em>, <b>28</b>(2), 169--181.</p>
<p>Cameron AC, Gelbach JB, Miller DL (2008).
  “Bootstrap-Based Improvements for Inference with Clustered Errors”,
  <em>The Review of Economics and Statistics</em>, <b>90</b>(3),
  414--427.
  <a href="https://doi.org/10.3386/t0344" class="external-link">doi:10.3386/t0344</a></p>  
<p>Cameron AC, Gelbach JB, Miller DL (2011).
  “Robust Inference with Multiway Clustering”,
  <em>Journal of Business &amp; Ecomomic Statistics</em>, <b>29</b>(2),
  238--249.
  <a href="https://doi.org/10.1198/jbes.2010.07136" class="external-link">doi:10.1198/jbes.2010.07136</a></p>  
<p>Kauermann G, Carroll RJ (2001).
  “A Note on the Efficiency of Sandwich Covariance Matrix
    Estimation”,
  <em>Journal of the American Statistical Association</em>,
  <b>96</b>(456), 1387--1396.
  <a href="https://doi.org/10.1198/016214501753382309" class="external-link">doi:10.1198/016214501753382309</a></p>
<p>Ma MS (2014).
  “Are We Really Doing What We Think We Are Doing? A Note on
    Finite-Sample Estimates of Two-Way Cluster-Robust Standard Errors”,
  <em>Mimeo, Availlable at SSRN:</em>
   URL <a href="https://www.ssrn.com/abstract=2420421" class="external-link">https://www.ssrn.com/abstract=2420421</a>.</p>
<p>MacKinnon JG, Nielsen MØ, Webb MD (2022). 
  “Cluster-Robust Inference: A Guide to Empirical Practice”, 
  <em>Journal of Econometrics</em>, Forthcoming.
  <a href="https://doi.org/10.1016/j.jeconom.2022.04.001" class="external-link">doi:10.1016/j.jeconom.2022.04.001</a></p>
<p>MacKinnon JG, White H (1985). 
  “Some Heteroskedasticity-Consistent Covariance Matrix Estimators with Improved Finite Sample Properties”
  <em>Journal of Econometrics</em>, <b>29</b>(3), 305--325.
  <a href="https://doi.org/10.1016/0304-4076%2885%2990158-7" class="external-link">doi:10.1016/0304-4076(85)90158-7</a></p>  
<p>Petersen MA (2009).
  “Estimating Standard Errors in Finance Panel Data Sets: Comparing Approaches”,
  <em>The Review of Financial Studies</em>, <b>22</b>(1), 435--480.
  <a href="https://doi.org/10.1093/rfs/hhn053" class="external-link">doi:10.1093/rfs/hhn053</a></p>
<p>Thompson SB (2011).
  “Simple Formulas for Standard Errors That Cluster by Both Firm
    and Time”,
  <em>Journal of Financial Economics</em>, <b>99</b>(1), 1--10.
  <a href="https://doi.org/10.1016/j.jfineco.2010.08.016" class="external-link">doi:10.1016/j.jfineco.2010.08.016</a></p>  
<p>Zeileis A (2004).
  “Econometric Computing with HC and HAC Covariance Matrix Estimator”,
  <em>Journal of Statistical Software</em>, <b>11</b>(10), 1--17.
  <a href="https://doi.org/10.18637/jss.v011.i10" class="external-link">doi:10.18637/jss.v011.i10</a></p>
<p>Zeileis A (2006).
  “Object-Oriented Computation of Sandwich Estimators”,
  <em>Journal of Statistical Software</em>, <b>16</b>(9), 1--16.
  <a href="https://doi.org/10.18637/jss.v016.i09" class="external-link">doi:10.18637/jss.v016.i09</a></p>
<p>Zeileis A, Köll S, Graham N (2020).
  “Various Versatile Variances: An Object-Oriented Implementation of Clustered Covariances in R.”
  <em>Journal of Statistical Software</em>, <b>95</b>(1), 1--36.
  <a href="https://doi.org/10.18637/jss.v095.i01" class="external-link">doi:10.18637/jss.v095.i01</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="vcovHC.html">vcovHC</a></code>, <code><a href="vcovBS.html">vcovBS</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## Petersen's data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"PetersenCL"</span>, package <span class="op">=</span> <span class="st">"sandwich"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">PetersenCL</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## clustered covariances</span></span>
<span class="r-in"><span class="co">## one-way</span></span>
<span class="r-in"><span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, cluster <span class="op">=</span> <span class="op">~</span> <span class="va">firm</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               (Intercept)             x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.490702e-03 -6.473517e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -6.473517e-05  2.559927e-03</span>
<span class="r-in"><span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, cluster <span class="op">=</span> <span class="va">PetersenCL</span><span class="op">$</span><span class="va">firm</span><span class="op">)</span> <span class="co">## same</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               (Intercept)             x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.490702e-03 -6.473517e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -6.473517e-05  2.559927e-03</span>
<span class="r-in"><span class="co">## one-way with HC2</span></span>
<span class="r-in"><span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, cluster <span class="op">=</span> <span class="op">~</span> <span class="va">firm</span>, type <span class="op">=</span> <span class="st">"HC2"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               (Intercept)             x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.494487e-03 -6.592912e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -6.592912e-05  2.568236e-03</span>
<span class="r-in"><span class="co">## two-way</span></span>
<span class="r-in"><span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, cluster <span class="op">=</span> <span class="op">~</span> <span class="va">firm</span> <span class="op">+</span> <span class="va">year</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               (Intercept)             x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.233313e-03 -2.845344e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -2.845344e-05  2.868462e-03</span>
<span class="r-in"><span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, cluster <span class="op">=</span> <span class="va">PetersenCL</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"firm"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">## same</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               (Intercept)             x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.233313e-03 -2.845344e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -2.845344e-05  2.868462e-03</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## comparison with cross-section sandwiches</span></span>
<span class="r-in"><span class="co">## HC0</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="sandwich.html">sandwich</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, <span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"HC0"</span>, cadjust <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span class="co">## HC2</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="vcovHC.html">vcovHC</a></span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"HC2"</span><span class="op">)</span>, <span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"HC2"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span class="co">## HC3</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="vcovHC.html">vcovHC</a></span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"HC3"</span><span class="op">)</span>, <span class="fu">vcovCL</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"HC3"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Innovation data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"InstInnovation"</span>, package <span class="op">=</span> <span class="st">"sandwich"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## replication of one-way clustered standard errors for model 3, Table I</span></span>
<span class="r-in"><span class="co">## and model 1, Table II in Berger et al. (2017), see ?InstInnovation</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## count regression formula</span></span>
<span class="r-in"><span class="va">f1</span> <span class="op">&lt;-</span> <span class="va">cites</span> <span class="op">~</span> <span class="va">institutions</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">capital</span><span class="op">/</span><span class="va">employment</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sales</span><span class="op">)</span> <span class="op">+</span> <span class="va">industry</span> <span class="op">+</span> <span class="va">year</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## model 3, Table I: Poisson model</span></span>
<span class="r-in"><span class="co">## one-way clustered standard errors</span></span>
<span class="r-in"><span class="va">tab_I_3_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">f1</span>, data <span class="op">=</span> <span class="va">InstInnovation</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span>
<span class="r-in"><span class="va">vcov_pois</span> <span class="op">&lt;-</span> <span class="fu">vcovCL</span><span class="op">(</span><span class="va">tab_I_3_pois</span>, <span class="va">InstInnovation</span><span class="op">$</span><span class="va">company</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">vcov_pois</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            institutions log(capital/employment)              log(sales) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             0.002406388             0.135953255             0.041523405 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## coefficient tables</span></span>
<span class="r-in"><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"lmtest"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html" class="external-link">coeftest</a></span><span class="op">(</span><span class="va">tab_I_3_pois</span>, vcov <span class="op">=</span> <span class="va">vcov_pois</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            Estimate  Std. Error   z value     Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> institutions            0.009687237 0.002406388  4.025634 5.682195e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log(capital/employment) 0.482883549 0.135953255  3.551835 3.825545e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log(sales)              0.820317600 0.041523405 19.755548 7.187199e-87</span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co">## model 1, Table II: negative binomial hurdle model</span></span>
<span class="r-in"><span class="co">## (requires "pscl" or alternatively "countreg" from R-Forge)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://github.com/atahk/pscl" class="external-link">"pscl"</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"lmtest"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">tab_II_3_hurdle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pscl/man/hurdle.html" class="external-link">hurdle</a></span><span class="op">(</span><span class="va">f1</span>, data <span class="op">=</span> <span class="va">InstInnovation</span>, dist <span class="op">=</span> <span class="st">"negbin"</span><span class="op">)</span></span>
<span class="r-in"><span class="co">#  dist = "negbin", zero.dist = "negbin", separate = FALSE)</span></span>
<span class="r-in"><span class="va">vcov_hurdle</span> <span class="op">&lt;-</span> <span class="fu">vcovCL</span><span class="op">(</span><span class="va">tab_II_3_hurdle</span>, <span class="va">InstInnovation</span><span class="op">$</span><span class="va">company</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">vcov_hurdle</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">149</span><span class="op">:</span><span class="fl">151</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html" class="external-link">coeftest</a></span><span class="op">(</span><span class="va">tab_II_3_hurdle</span>, vcov <span class="op">=</span> <span class="va">vcov_hurdle</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">149</span><span class="op">:</span><span class="fl">151</span><span class="op">)</span>, <span class="op">]</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Achim Zeileis, Thomas Lumley.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

